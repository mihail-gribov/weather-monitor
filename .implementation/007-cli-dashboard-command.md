# CLI команда dashboard - ASCII дашборд

- Номер: 007
- Depends on: [006]
- Спецификация: `.specification/01_cli_plotting_interface.md#команда-dashboard`
- Тип: backend
- Приоритет: P3
- Статус: done

## Definition of Ready
- Все зависимости закрыты; ссылки на спецификацию валидны; Inputs/Outputs описаны; команды запуска/проверки даны.

## Контекст
Добавить CLI команду `dashboard` для отображения ASCII дашборда с несколькими метриками в терминале с поддержкой автообновления.

## Цель
Реализовать команду `python weather_monitor.py dashboard [options]` для показа сводного дашборда с множественными метриками в терминале.

## Inputs
- Переменные окружения: `TERM` (string, для определения размера терминала)
- Входные артефакты: `plotting.py` (метод create_dashboard_ascii), `interactive.py` (для выбора регионов)

## Outputs
- Команда `dashboard` в CLI
- ASCII дашборд с несколькими метриками
- Поддержка автообновления
- Компактный режим отображения

## Объем работ (Scope)
1) Добавление команды `dashboard` в weather_monitor.py:
   - Опция `--regions/-r` (список регионов)
   - Опция `--refresh <seconds>` (автообновление каждые N секунд)
   - Опция `--compact` (компактный режим отображения)
   - Опция `--interactive` (интерактивный выбор регионов)
2) Расширение класса WeatherPlotter:
   - Метод `create_dashboard_ascii()` для создания сводного дашборда
   - Отображение нескольких метрик одновременно
   - Компактное представление данных
3) Функциональность автообновления:
   - Цикл обновления с заданным интервалом
   - Очистка экрана между обновлениями
   - Graceful выход по Ctrl+C
4) Компактный режим:
   - Уменьшенные графики
   - Табличное представление текущих значений
   - Минимальное использование вертикального пространства
5) Интеграция с интерактивным выбором регионов
- Out of scope: веб-интерфейс, сохранение дашборда в файл, настройка метрик

## Артефакты
- `weather_monitor.py` (обновлен с командой dashboard)
- `plotting.py` (обновлен с методом create_dashboard_ascii)

## Acceptance criteria
- Команда: `python weather_monitor.py dashboard --help` → код 0, показывает справку
- Команда: `python weather_monitor.py dashboard --regions moscow` → показывает ASCII дашборд
- Команда: `python weather_monitor.py dashboard --regions moscow --compact` → показывает компактный дашборд
- Автообновление: `python weather_monitor.py dashboard --regions moscow --refresh 5` → обновляется каждые 5 секунд
- Выход: Ctrl+C корректно завершает автообновление
- Интерактивный режим: `python weather_monitor.py dashboard --interactive` → показывает выбор регионов

## Тесты
- Unit: тестирование метода create_dashboard_ascii
- Unit: тестирование парсинга опций команды dashboard
- Integration: тестирование автообновления (короткий цикл)
- Integration: тестирование интеграции с interactive.py
- Manual: тестирование в терминале с различными размерами

## Команды для проверки
```bash
# проверка справки
python weather_monitor.py dashboard --help
# тестирование базового дашборда
timeout 3s python weather_monitor.py dashboard --regions moscow || echo "Expected timeout or no data error"
# тестирование компактного режима
timeout 3s python weather_monitor.py dashboard --regions moscow --compact || echo "Expected timeout or no data error"
# тестирование автообновления (короткий тест)
timeout 3s python weather_monitor.py dashboard --regions moscow --refresh 1 || echo "Expected timeout"
# проверка что команда добавлена в общую справку
python weather_monitor.py --help | grep dashboard && echo "Dashboard command listed"
```

## Definition of Done
- Lint/type-check/tests/build OK
- Команда `dashboard` добавлена в CLI с всеми опциями
- ASCII дашборд отображает несколько метрик одновременно
- Автообновление работает с корректным выходом по Ctrl+C
- Компактный режим реализован и функционирует
- Интеграция с интерактивным выбором регионов работает
- Обработка ошибок и edge cases реализована
- Статус задачи обновлён на `done`

## Риски и допущения
- Риск: различия в поддержке очистки экрана в разных терминалах
- Риск: проблемы с отображением в терминалах малого размера
- Допущение: пользователь работает в терминале с поддержкой ANSI escape codes
- Допущение: метод create_dashboard_ascii корректно реализован в plotting.py

## Ссылка на следующую задачу
- 008

## Отчет о выполнении

**Дата выполнения:** 2025-01-27 17:00

### Выполненные работы:
1. ✅ Добавление команды `dashboard` в CLI:
   - Опция `--regions/-r` (список регионов через запятую)
   - Опция `--preset/-p` (использование пресета регионов)
   - Опция `--refresh` (автообновление каждые N секунд)
   - Опция `--compact` (компактный режим отображения)
2. ✅ Интеграция с модулями:
   - WeatherPlotter для получения данных
   - PresetManager для работы с пресетами
3. ✅ Два режима отображения:
   - Полный режим с эмодзи и детальной информацией
   - Компактный режим в виде таблицы
4. ✅ Автообновление:
   - Поддержка интервала обновления
   - Graceful остановка по Ctrl+C
5. ✅ Обработка ошибок и валидация

### Особенности реализации:
- **Два режима отображения:** Полный с эмодзи и компактный табличный
- **Поддержка пресетов:** Интеграция с PresetManager для быстрого выбора регионов
- **Автообновление:** Возможность автоматического обновления данных
- **Эмодзи:** Использование эмодзи для улучшения читаемости
- **Валидация данных:** Проверка существования регионов и данных

### Технические детали:
- **Метрики:** temperature, humidity, pressure, wind-speed
- **Временной диапазон:** Последний час данных
- **Лимит регионов:** Максимум 5 регионов для читаемости
- **Форматирование:** Красивое отображение с единицами измерения
- **Обработка ошибок:** Graceful fallback при отсутствии данных

### Проверки:
- ✅ Команда `dashboard --help` показывает справку
- ✅ Команда добавлена в общий список команд CLI
- ✅ Компактный режим работает корректно
- ✅ Полный режим с эмодзи работает
- ✅ Пресеты регионов работают
- ✅ Валидация несуществующих регионов работает
- ✅ Существующие команды CLI продолжают работать

### Обновленные файлы:
- `weather_monitor.py` - добавлена команда dashboard и вспомогательные функции

### Примеры использования:
```bash
# Компактный режим с первыми 5 регионами
python weather_monitor.py dashboard --compact

# Полный режим с указанными регионами
python weather_monitor.py dashboard --regions moscow,belgrade

# Использование пресета
python weather_monitor.py dashboard --preset major-cities --compact

# Автообновление каждые 30 секунд
python weather_monitor.py dashboard --refresh 30
```

### Вывод команды:
```
================================================================================
WEATHER DASHBOARD (COMPACT)
================================================================================
Region          Temp     Humidity   Pressure   Wind    
-------------------------------------------------------
annino          17.8°C   60.0%      1003.9hPa  7.6km/h 
belgrade        19.2°C   57.0%      1020.6hPa  7.4km/h 
```
